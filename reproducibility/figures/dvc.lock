schema: '2.0'
stages:
  data_load:
    cmd: python data_load.py --config=config.yaml
    deps:
    - path: data_load.py
      md5: 719e8518cc12d92ca3fd60bc019ab1c1
      size: 1956
    params:
      config.yaml:
        base:
          log_level: INFO
        data_external.pancreas:
          data_file: endocrinogenesis_day15.h5ad
          dl_root: data/Pancreas
          dl_path: data/Pancreas/endocrinogenesis_day15.h5ad
          rel_path: data/external/endocrinogenesis_day15.h5ad
          url: https://github.com/theislab/scvelo_notebooks/raw/master/data/Pancreas/endocrinogenesis_day15.h5ad
    outs:
    - path: data/external/endocrinogenesis_day15.h5ad
      md5: 783ec70c72fd895eeea28c07735efc27
      size: 52477898
  data_download:
    cmd: python data_download.py --config=config.yaml
    deps:
    - path: data_download.py
      md5: 6c28129f51067c89efbf28b2cd1f431b
      size: 2971
    params:
      config.yaml:
        base:
          log_level: INFO
        data_external.pyrovelocity.larry:
          data_file: larry.h5ad
          dl_root: data/external
          dl_path: data/external/larry.h5ad
          rel_path: data/external/larry.h5ad
          url: https://ndownloader.figshare.com/files/37028569
        data_external.scvelo.pancreas:
          data_file: endocrinogenesis_day15.h5ad
          dl_root: data/Pancreas
          dl_path: data/Pancreas/endocrinogenesis_day15.h5ad
          rel_path: data/external/endocrinogenesis_day15.h5ad
          url: https://github.com/theislab/scvelo_notebooks/raw/master/data/Pancreas/endocrinogenesis_day15.h5ad
          derived:
            process_method: load_data
            rel_path: data/processed/pancreas_processed.h5ad
        data_external.scvelo.pbmc68k:
          data_file: pbmc68k.h5ad
          dl_root: data/PBMC
          dl_path: data/PBMC/pbmc68k.h5ad
          rel_path: data/external/pbmc68k.h5ad
          url: https://ndownloader.figshare.com/files/27686886
          derived:
            process_method: load_pbmc
            rel_path: data/processed/pbmc_processed.h5ad
    outs:
    - path: data/external/endocrinogenesis_day15.h5ad
      md5: 783ec70c72fd895eeea28c07735efc27
      size: 52477898
    - path: data/external/larry.h5ad
      md5: d618305c0ee0e41570b1147e63df332a
      size: 1525338690
    - path: data/external/pbmc68k.h5ad
      md5: ee0953e5fb994bc3cec05d4cf638ac79
      size: 123707283
  preprocess:
    cmd: python preprocess.py --config=config.yaml
    deps:
    - path: data/external/endocrinogenesis_day15.h5ad
      md5: 783ec70c72fd895eeea28c07735efc27
      size: 52477898
    - path: data/external/pbmc68k.h5ad
      md5: ee0953e5fb994bc3cec05d4cf638ac79
      size: 123707283
    - path: preprocess.py
      md5: 1d4a14a5ff1328d499e72514ee442e9a
      size: 2542
    params:
      config.yaml:
        base:
          log_level: INFO
        data_external.scvelo.pancreas:
          data_file: endocrinogenesis_day15.h5ad
          dl_root: data/Pancreas
          dl_path: data/Pancreas/endocrinogenesis_day15.h5ad
          rel_path: data/external/endocrinogenesis_day15.h5ad
          url: https://github.com/theislab/scvelo_notebooks/raw/master/data/Pancreas/endocrinogenesis_day15.h5ad
          derived:
            process_method: load_data
            rel_path: data/processed/pancreas_processed.h5ad
        data_external.scvelo.pbmc68k:
          data_file: pbmc68k.h5ad
          dl_root: data/PBMC
          dl_path: data/PBMC/pbmc68k.h5ad
          rel_path: data/external/pbmc68k.h5ad
          url: https://ndownloader.figshare.com/files/27686886
          derived:
            process_method: load_pbmc
            rel_path: data/processed/pbmc_processed.h5ad
    outs:
    - path: data/processed/pancreas_processed.h5ad
      md5: 7af1dfb39e8d77008a94b1c17c9c3858
      size: 424767328
    - path: data/processed/pbmc_processed.h5ad
      md5: 0a1eb8cd91bdee14ea9898b284e53f5e
      size: 412368967
  train_pancreas_model1:
    cmd: python fig2/fig2_pancreas_train.py --config=config.yaml
    deps:
    - path: data/processed/pancreas_processed.h5ad
      md5: 7af1dfb39e8d77008a94b1c17c9c3858
      size: 424767328
    - path: fig2/fig2_pancreas_train.py
      md5: f353dda90c2342b35c2fc06ef7b7c946
      size: 4787
    params:
      config.yaml:
        model_training.pancreas_model1:
          path: models/pancreas_model1
          model_path: models/pancreas_model1/model
          trained_data_path: models/pancreas_model1/trained.h5ad
          pyrovelocity_data_path: models/pancreas_model1/pyrovelocity.pkl
    outs:
    - path: models/pancreas_model1/model
      md5: a4db44f3261ab3fdbf93590a452bebdb.dir
      size: 1159443
      nfiles: 4
    - path: models/pancreas_model1/pyrovelocity.pkl
      md5: 757ffff483fb95bb3f08af88aff2bfd4
      size: 7102321859
    - path: models/pancreas_model1/trained.h5ad
      md5: bf05b29b0d0573ae6f5b9b4bde7a2bac
      size: 489752680
  plot_pancreas_model1:
    cmd: python fig2/fig2_pancreas_plot.py --config=config.yaml
    deps:
    - path: fig2/fig2_pancreas_plot.py
      md5: f3d1dfafd9d7572a541e84ff43fdbbf5
      size: 5932
    - path: models/pancreas_model1/pyrovelocity.pkl
      md5: 757ffff483fb95bb3f08af88aff2bfd4
      size: 7102321859
    - path: models/pancreas_model1/trained.h5ad
      md5: bf05b29b0d0573ae6f5b9b4bde7a2bac
      size: 489752680
    params:
      config.yaml:
        model_training.pancreas_model1:
          path: models/pancreas_model1
          model_path: models/pancreas_model1/model
          trained_data_path: models/pancreas_model1/trained.h5ad
          pyrovelocity_data_path: models/pancreas_model1/pyrovelocity.pkl
        reports.figure2.pancreas_model1:
          shared_time_plot: reports/fig2/fig2_pancreas_shared_time.pdf
          volcano_plot: reports/fig2/fig2_pancreas_volcano.pdf
          rainbow_plot: reports/fig2/fig2_pancreas_rainbow.pdf
          vector_field_plot: reports/fig2/fig2_pancreas_vector_field.pdf
    outs:
    - path: reports/fig2/fig2_pancreas_rainbow.pdf
      md5: 9f07830302c1eea3643f1bf0e7cd2b7a
      size: 663311
    - path: reports/fig2/fig2_pancreas_shared_time.pdf
      md5: 29e04b9dadd81b00efcc95e285ddf8b5
      size: 616498
    - path: reports/fig2/fig2_pancreas_vector_field.pdf
      md5: 81812deb48b687d34d4d2660e8fb4641
      size: 408048
    - path: reports/fig2/fig2_pancreas_volcano.pdf
      md5: ce1df5f5b991c9c0d9a7f0ebcf55d8db
      size: 46339
