vars:
  - config.yaml

stages:
  data_download:
    cmd: python data_download.py --config=config.yaml
    deps:
      - data_download.py
    params:
      - config.yaml:
          - base
          - data_external.scvelo.pancreas
          - data_external.scvelo.pbmc68k
          - data_external.pyrovelocity.larry
    outs:
      - ${data_external.scvelo.pancreas.rel_path}:
          persist: true
      - ${data_external.scvelo.pbmc68k.rel_path}:
          persist: true
      - ${data_external.pyrovelocity.larry.rel_path}:
          persist: true

  preprocess:
    cmd: python preprocess.py --config=config.yaml
    deps:
      - preprocess.py
      - ${data_external.scvelo.pancreas.rel_path}
      - ${data_external.scvelo.pbmc68k.rel_path}
    params:
      - config.yaml:
          - base
          - data_external.scvelo.pancreas
          - data_external.scvelo.pbmc68k
    outs:
      - ${data_external.scvelo.pancreas.derived.rel_path}:
          persist: true
      - ${data_external.scvelo.pbmc68k.derived.rel_path}:
          persist: true

  train_pancreas_model1:
    cmd: python train.py model_training.train=[pancreas_model1]
    deps:
      - train.py
      - ${model_training.pancreas_model1.input_data_path}
    params:
      - config.yaml:
          - model_training.pancreas_model1
    outs:
      - ${model_training.pancreas_model1.trained_data_path}:
          persist: true
      - ${model_training.pancreas_model1.model_path}:
          persist: true
      - ${model_training.pancreas_model1.pyrovelocity_data_path}:
          persist: true

  plot_pancreas_model1:
    cmd: python fig2/fig2_pancreas_plot.py --config=config.yaml
    deps:
      - fig2/fig2_pancreas_plot.py
      - ${model_training.pancreas_model1.trained_data_path}
      - ${model_training.pancreas_model1.pyrovelocity_data_path}
    params:
      - config.yaml:
          - model_training.pancreas_model1
          - reports.figure2.pancreas_model1
    outs:
      - ${reports.figure2.pancreas_model1.shared_time_plot}:
          persist: true
      - ${reports.figure2.pancreas_model1.volcano_plot}:
          persist: true
      - ${reports.figure2.pancreas_model1.rainbow_plot}:
          persist: true
      - ${reports.figure2.pancreas_model1.vector_field_plot}:
          persist: true

  train_pbmc68k_model1:
    cmd: python train.py model_training.train=[pbmc68k_model1]
    deps:
      - train.py
      - ${model_training.pbmc68k_model1.input_data_path}
    params:
      - config.yaml:
          - model_training.pbmc68k_model1
    outs:
      - ${model_training.pbmc68k_model1.trained_data_path}:
          persist: true
      - ${model_training.pbmc68k_model1.model_path}:
          persist: true
      - ${model_training.pbmc68k_model1.pyrovelocity_data_path}:
          persist: true
